# === Stage 1: Build the Application JAR ===
# Use a standard OpenJDK image that we can install Gradle into temporarily
FROM openjdk:21-jdk-alpine AS build

WORKDIR /app

# Copy the Gradle wrapper files and source code
COPY gradlew gradlew.bat ./
COPY gradle ./gradle
COPY build.gradle settings.gradle ./
COPY src ./src

# Make the wrapper script executable and run the build
RUN chmod +x gradlew
RUN ./gradlew build --no-daemon -x test

# === Stage 2: Run the Application with a Minimal Runtime Image ===
FROM openjdk:21-jre-slim

WORKDIR /app
EXPOSE 8080
COPY --from=build /app/build/libs/*.jar app.jar
ENTRYPOINT ["java", "-jar", "app.jar"]
